<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hyping-style Shop</title>
<style>
  :root{
    --bg: #f7f7fb; --card: #ffffff; --text: #222; --muted: #666;
    --brand: #a0c4ff; --accent: #f8c8dc; --accent-2:#a8d5ba; --accent-3:#fff6bd;
    --border: #e9e9ef; --shadow: 0 10px 25px rgba(0,0,0,.08);
    --radius-xl: 18px; --radius-lg: 14px; --radius-md: 10px;
  }
  *{ box-sizing:border-box; } html,body{ height:100%; margin:0; }
  body{ font-family: ui-sans-serif, system-ui; background: linear-gradient(180deg, var(--bg), #fff 60%); color:var(--text); }

  nav{ position:sticky;top:0;z-index:20;background:var(--card);border-bottom:1px solid var(--border); }
  .nav-inner{ max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between; }
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;}
  .logo{width:34px;height:34px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));box-shadow:var(--shadow);}

  .nav-links{display:flex;gap:24px;}
  .nav-links a{ text-decoration:none;color:var(--text);font-weight:600;position:relative; }
  .nav-links a::after{content:"";position:absolute;left:0;bottom:-4px;height:3px;width:0;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--brand),var(--accent-2));transition:.25s;}
  .nav-links a:hover::after{width:100%;}

  .toolbar{max-width:1200px;margin:22px auto 0;padding:0 20px;display:flex;gap:12px;}
  .search{flex:1;position:relative;}
  .search input{width:100%;padding:12px 14px 12px 42px;border-radius:12px;border:1px solid var(--border);}
  .search .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);width:20px;height:20px;background:radial-gradient(circle,var(--accent),var(--brand));border-radius:50%;opacity:.6;}
  .pill{padding:10px 14px;border:1px solid var(--border);border-radius:999px;background:var(--card);cursor:pointer;}

  .container{max-width:1200px;margin:28px auto;padding:0 20px;display:grid;grid-template-columns:1fr 360px;gap:24px;}
  @media(max-width:980px){.container{grid-template-columns:1fr;}}

  .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px;}
  @media(max-width:980px){.grid{grid-template-columns:repeat(2,minmax(0,1fr));}}
  @media(max-width:560px){.grid{grid-template-columns:1fr;}}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-xl);padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px;transition:.25s;}
  .card:hover{transform:translateY(-3px);}
  .thumb{border-radius:var(--radius-lg);overflow:hidden;aspect-ratio:4/3;background:linear-gradient(135deg,var(--accent-3),var(--brand));}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block;}
  .meta{display:flex;justify-content:space-between;align-items:center;}
  .title{font-weight:800;}
  .price{font-weight:800;}
  .tag{font-size:.75rem;color:var(--muted);}
  .actions{display:flex;gap:8px;}
  .qty{display:flex;align-items:center;border:1px solid var(--border);border-radius:12px;}
  .qty button{background:transparent;border:none;padding:8px 10px;cursor:pointer;font-weight:800;}
  .qty input{width:42px;border:none;text-align:center;}

  .btn{border:1px solid var(--border);background:var(--card);padding:10px 14px;border-radius:999px;font-weight:700;cursor:pointer;}
  .btn.brand{background:linear-gradient(135deg,var(--brand),var(--accent));border:none;color:#111;}
  .btn.full{width:100%;}
  .btn.secondary{background:var(--accent-3);border:none;}

  .cart{position:sticky;top:84px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-xl);padding:16px;box-shadow:var(--shadow);}
  .cart-empty{color:var(--muted);}
  .cart-list{display:flex;flex-direction:column;gap:12px;}
  .cart-item{display:grid;grid-template-columns:1fr auto;gap:8px;padding:10px;border:1px dashed var(--border);border-radius:var(--radius-md);}
  .cart-item .name{font-weight:700;}
  .cart-item .remove{color:red;cursor:pointer;background:transparent;border:none;font-weight:800;}

  .totals{margin-top:12px;border-top:1px solid var(--border);padding-top:12px;display:grid;gap:6px;}
  .totals .row{display:flex;justify-content:space-between;}
  .total{font-size:1.25rem;font-weight:900;}

  .toast{position:fixed;right:16px;bottom:16px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(6px);transition:.25s;}
  .toast.show{opacity:1;transform:translateY(0);}

  /* Popup */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:50;}
  .modal-content{background:var(--card);padding:20px;border-radius:var(--radius-xl);width:90%;max-width:400px;box-shadow:var(--shadow);}
  .modal-content h3{margin-top:0;}
  .warning{background:rgba(255,0,0,0.1);color:red;padding:10px;border-radius:var(--radius-md);margin:10px 0;}
  .modal-content input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid var(--border);}
  .modal-actions{display:flex;gap:10px;margin-top:10px;}
  .modal-actions .btn{flex:1;}
</style>
</head>
<body>

<nav>
  <div class="nav-inner">
    <div class="brand"><div class="logo"></div><span>Hyping-style</span></div>
    <div class="nav-links">
      <a href="#nouveautes">Nouveautés</a>
      <a href="#tops">Top ventes</a>
    </div>
  </div>
</nav>

<div class="toolbar">
  <div class="search">
    <div class="icon"></div>
    <input id="searchInput" type="search" placeholder="Rechercher un produit... (nom, tag)" />
  </div>
  <button class="pill" id="resetFilters">Réinitialiser</button>
</div>

<main class="container">
  <section><div class="grid" id="productGrid"></div></section>
  <aside class="cart">
    <h3>Votre panier</h3>
    <div class="cart-empty" id="cartEmpty">Le panier est vide.</div>
    <div class="cart-list" id="cartList" hidden></div>
    <div class="totals">
      <div class="row"><span>Sous-total</span><strong id="subtotal">0,00 €</strong></div>
      <div class="row"><span>Frais (est.)</span><span id="fees">0,00 €</span></div>
      <div class="row total"><span>Total</span><span id="total">0,00 €</span></div>
    </div>
    <div class="stack">
      <button class="btn full brand" id="sendOrder">Envoyer la commande</button>
      <button class="btn full secondary" id="clearCart">Vider le panier</button>
    </div>
  </aside>
</main>

<div class="toast" id="toast"></div>

<!-- Modal -->
<div class="modal" id="orderModal">
  <div class="modal-content">
    <h3>Finaliser la commande</h3>
    <input id="pseudoDiscord" placeholder="Votre pseudo Discord" />
    <input id="pseudoMinecraft" placeholder="Votre pseudo Minecraft" />
    <div class="warning">⚠️ Toute commande peut être annulée. Le joueur doit payer avant de recevoir sa commande.</div>
    <div class="modal-actions">
      <button class="btn secondary" id="cancelOrder">Annuler</button>
      <button class="btn brand" id="confirmOrder">Envoyer</button>
    </div>
  </div>
</div>

<script>
const fmt = n => (n||0).toLocaleString("fr-FR",{style:"currency",currency:"EUR"});
function toast(msg, ms=1600){
  const box = document.getElementById("toast");
  box.textContent = msg;
  box.classList.add("show");
  setTimeout(() => box.classList.remove("show"), ms);
}

let PRODUCTS = [];
async function loadProducts(){
  try {
    const res = await fetch("products.json");
    PRODUCTS = await res.json();
    renderProducts();
  } catch(e){ toast("Erreur chargement produits"); }
}

const grid = document.getElementById("productGrid");
function renderProducts(list=PRODUCTS){
  grid.innerHTML="";
  list.forEach(p=>{
    const card=document.createElement("article");
    card.className="card";
    card.innerHTML=`
      <div class="thumb"><img src="${p.image}" alt=""></div>
      <div class="meta"><div><div class="title">${p.name}</div><div class="tag">#${p.tag}</div></div><div class="price">${fmt(p.price)}</div></div>
      <div class="actions">
        <div class="qty"><button data-action="dec">−</button><input type="number" min="1" value="1"/><button data-action="inc">+</button></div>
        <button class="btn add" data-id="${p.id}">Ajouter</button>
      </div>`;
    const input=card.querySelector("input");
    card.querySelector('[data-action="inc"]').onclick=()=>input.value=(+input.value||1)+1;
    card.querySelector('[data-action="dec"]').onclick=()=>input.value=Math.max(1,(+input.value||1)-1);
    card.querySelector(".btn.add").onclick=()=>addToCart(p.id,+input.value||1);
    grid.appendChild(card);
  });
}

let CART=[];
const cartList=document.getElementById("cartList"),cartEmpty=document.getElementById("cartEmpty");
const subtotalEl=document.getElementById("subtotal"),feesEl=document.getElementById("fees"),totalEl=document.getElementById("total");

function syncCartUI(){
  if(CART.length===0){cartEmpty.hidden=false;cartList.hidden=true;cartList.innerHTML="";subtotalEl.textContent=fmt(0);feesEl.textContent=fmt(0);totalEl.textContent=fmt(0);return;}
  cartEmpty.hidden=true;cartList.hidden=false;cartList.innerHTML="";
  let subtotal=0;
  CART.forEach(item=>{
    const lineTotal=item.price*item.qty;subtotal+=lineTotal;
    const row=document.createElement("div");row.className="cart-item";
    row.innerHTML=`<div><div class="name">${item.name}</div><div class="tag">${fmt(item.price)} × ${item.qty}</div></div><div class="line"><strong>${fmt(lineTotal)}</strong><button class="remove">✕</button></div>`;
    row.querySelector(".remove").onclick=()=>{CART=CART.filter(x=>x.id!==item.id);syncCartUI();};
    cartList.appendChild(row);
  });
  const fees=subtotal>0?Math.max(2,subtotal*0.02):0;
  subtotalEl.textContent=fmt(subtotal);feesEl.textContent=fmt(fees);totalEl.textContent=fmt(subtotal+fees);
}
function addToCart(id,qty=1){const p=PRODUCTS.find(x=>x.id===id);if(!p)return;const ex=CART.find(x=>x.id===id);if(ex){ex.qty+=qty;}else{CART.push({id:p.id,name:p.name,price:p.price,qty});}syncCartUI();toast("Ajouté au panier");}

function buildOrder(pseudoDiscord,pseudoMinecraft){
  const items=CART.map(x=>({id:x.id,name:x.name,unitPrice:x.price,qty:x.qty,lineTotal:+(x.price*x.qty).toFixed(2)}));
  const subtotal=items.reduce((s,i)=>s+i.lineTotal,0);
  const fees=subtotal>0?+(Math.max(2,subtotal*0.02).toFixed(2)):0;
  const total=+(subtotal+fees).toFixed(2);
  return {
    content: "🛒 Nouvelle commande",
    embeds: [{
      title: "Nouvelle Commande",
      color: 5814783,
      fields: [
        {name:"Pseudo Discord", value:pseudoDiscord||"Non fourni"},
        {name:"Pseudo Minecraft", value:pseudoMinecraft||"Non fourni"},
        {name:"Articles", value: items.map(i=>`**${i.name}** ×${i.qty} = ${i.lineTotal}€`).join("\n") || "Aucun"},
        {name:"Sous-total", value: subtotal+" €", inline:true},
        {name:"Frais", value: fees+" €", inline:true},
        {name:"Total", value: total+" €", inline:true}
      ],
      footer:{text:"Commande ID: "+Date.now()}
    }]
  };
}

const modal=document.getElementById("orderModal");
document.getElementById("sendOrder").onclick=()=>{if(CART.length===0){toast("Ajoutez des articles");return;}modal.style.display="flex";};
document.getElementById("cancelOrder").onclick=()=>{modal.style.display="none";};

document.getElementById("confirmOrder").onclick=async()=>{
  const pseudoDiscord=document.getElementById("pseudoDiscord").value.trim();
  const pseudoMinecraft=document.getElementById("pseudoMinecraft").value.trim();
  const order=buildOrder(pseudoDiscord,pseudoMinecraft);
  try{
    const WEBHOOK_URL="https://discord.com/api/webhooks/1410210662797541456/KILtB46TRvAJH1-fvisTcnAdUpJklEQ1KwZF7btsayh1LvnVHijqO6zH02L-yXoFqG27"; // ⚠️ Mets ton vrai webhook
    const res=await fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(order)});
    if(!res.ok)throw new Error("HTTP "+res.status);
    toast("Commande envoyée ✅");modal.style.display="none";CART=[];syncCartUI();
  }catch(e){console.error(e);toast("Échec envoi ❌");}
};

document.getElementById("clearCart").onclick=()=>{CART=[];syncCartUI();toast("Panier vidé");};

const searchInput=document.getElementById("searchInput");
searchInput.addEventListener("input",e=>{
  const q=e.target.value.trim().toLowerCase();
  if(!q){renderProducts();return;}
  const filtered=PRODUCTS.filter(p=>p.name.toLowerCase().includes(q)||(p.tag||"").toLowerCase().includes(q));
  renderProducts(filtered);
});
document.getElementById("resetFilters").onclick=()=>{searchInput.value="";renderProducts();};

loadProducts();syncCartUI();
</script>
</body>
</html>

